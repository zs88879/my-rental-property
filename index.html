<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luxury Coastal Retreat - Calendar</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8f9fa;
            color: #333;
        }

        /* Existing styles preserved */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Calendar Styles */
        .calendar-widget {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin: 30px 0;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-nav {
            background: #4a6fa5;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
        }

        .calendar-nav:hover {
            background: #3a5a8a;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 20px;
        }

        .calendar-day-header {
            text-align: center;
            font-weight: bold;
            padding: 10px;
            color: #666;
            font-size: 14px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            position: relative;
            font-size: 14px;
            transition: all 0.2s;
        }

        .calendar-day:hover {
            background: #f0f4f8;
        }

        .calendar-day.available {
            background: #e8f5e9;
            border-color: #81c784;
        }

        .calendar-day.booked {
            background: #ffebee;
            border-color: #ef9a9a;
            cursor: not-allowed;
            color: #d32f2f;
        }

        .calendar-day.selected {
            background: #4a6fa5;
            color: white;
            border-color: #4a6fa5;
        }

        .calendar-day.disabled {
            background: #f5f5f5;
            color: #ccc;
            cursor: not-allowed;
        }

        .price-tag {
            font-size: 10px;
            position: absolute;
            bottom: 2px;
            right: 4px;
            color: #2e7d32;
        }

        .selected-dates {
            background: #f0f4f8;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .date-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .date-input {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            background: white;
        }

        .book-button {
            background: #4a6fa5;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            width: 100%;
        }

        .book-button:hover {
            background: #3a5a8a;
        }

        .book-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .legend {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 20px;
            font-size: 14px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
    </style>
</head>
<body>
    <!-- Your existing content here... -->

    <!-- Replace the "Check Availability & Book" section with this: -->
    <section class="container">
        <h2>Check Availability & Book</h2>
        
        <div class="calendar-widget">
            <h3>Select Your Dates</h3>
            <p style="color: #666; margin-bottom: 20px;">ðŸ“… Bookings available up to 3 months from today</p>
            
            <div class="selected-dates" id="selectedDates">
                <h4>Selected Dates</h4>
                <div class="date-inputs">
                    <div>
                        <label>Check-in:</label>
                        <input type="text" class="date-input" id="checkin" placeholder="Select check-in date" readonly>
                    </div>
                    <div>
                        <label>Check-out:</label>
                        <input type="text" class="date-input" id="checkout" placeholder="Select check-out date" readonly>
                    </div>
                </div>
                <div id="pricingSummary" style="display: none;">
                    <hr style="margin: 15px 0;">
                    <p><strong>Total Nights: </strong><span id="totalNights">0</span></p>
                    <p><strong>Total Price: </strong><span id="totalPrice" style="color: #2e7d32; font-size: 24px;">$0</span></p>
                </div>
            </div>

            <div class="calendar-header">
                <button class="calendar-nav" id="prevMonth"><i class="fas fa-chevron-left"></i> Previous</button>
                <h3 id="currentMonth" style="margin: 0;"></h3>
                <button class="calendar-nav" id="nextMonth">Next <i class="fas fa-chevron-right"></i></button>
            </div>

            <div class="calendar-grid" id="calendar"></div>

            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #e8f5e9; border-color: #81c784;"></div>
                    <span>Available</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #ffebee; border-color: #ef9a9a;"></div>
                    <span>Booked</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #4a6fa5;"></div>
                    <span>Selected</span>
                </div>
            </div>

            <button class="book-button" id="bookButton" disabled>
                Select dates to book
            </button>
        </div>
    </section>

    <script>
        // Configuration
        const NIGHTLY_RATE = 299;
        const MAX_BOOKING_MONTHS = 3;
        
        // State
        let currentDate = new Date();
        let selectedCheckin = null;
        let selectedCheckout = null;
        let bookedDates = new Set();
        
        // Load your Google Sheet data
        async function loadBookingData() {
            try {
                // Replace with your actual CSV URL
                const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQrRbWKrKBZ9HZThn3O0ns8DvJinCBtL7ICXglk5FvvAWcQv1xVf551hrq2UVC_4cB7Ifq9pn2E9XsQ/pub?gid=0&single=true&output=csv';
                
                const response = await fetch(csvUrl);
                const csvText = await response.text();
                
                // Parse CSV - adjust column names based on your sheet
                parseBookingsFromCSV(csvText);
                renderCalendar();
            } catch (error) {
                console.error('Error loading booking data:', error);
                // Use sample data for demo
                loadSampleBookings();
                renderCalendar();
            }
        }
        
        // Parse booking dates from CSV
        function parseBookingsFromCSV(csvText) {
            const lines = csvText.split('\n').slice(1); // Skip header
            bookedDates.clear();
            
            lines.forEach(line => {
                const [startDate, endDate, status] = line.split(',');
                if (status && status.toLowerCase().includes('booked')) {
                    const start = new Date(startDate);
                    const end = new Date(endDate);
                    addDateRangeToBookedDates(start, end);
                }
            });
        }
        
        // Add a range of dates to the booked set
        function addDateRangeToBookedDates(startDate, endDate) {
            const current = new Date(startDate);
            while (current <= endDate) {
                bookedDates.add(formatDate(current));
                current.setDate(current.getDate() + 1);
            }
        }
        
        // Sample booking data for demonstration
        function loadSampleBookings() {
            const today = new Date();
            const sampleRanges = [
                {start: 5, end: 10},   // Booked 5 days from now
                {start: 15, end: 20},  // Booked 15 days from now
                {start: 28, end: 35},  // Booked next month
            ];
            
            sampleRanges.forEach(range => {
                const start = new Date(today);
                start.setDate(today.getDate() + range.start);
                const end = new Date(today);
                end.setDate(today.getDate() + range.end);
                addDateRangeToBookedDates(start, end);
            });
        }
        
        // Format date as YYYY-MM-DD
        function formatDate(date) {
            return date.toISOString().split('T')[0];
        }
        
        // Check if date is booked
        function isDateBooked(date) {
            return bookedDates.has(formatDate(date));
        }
        
        // Check if date is in the past
        function isPastDate(date) {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            return date < today;
        }
        
        // Check if date is beyond booking window
        function isBeyondBookingWindow(date) {
            const maxDate = new Date();
            maxDate.setMonth(maxDate.getMonth() + MAX_BOOKING_MONTHS);
            return date > maxDate;
        }
        
        // Render calendar
        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // Update header
            document.getElementById('currentMonth').textContent = 
                firstDay.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            
            // Clear calendar
            const calendar = document.getElementById('calendar');
            calendar.innerHTML = '';
            
            // Add day headers
            const dayHeaders = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            dayHeaders.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-day-header';
                header.textContent = day;
                calendar.appendChild(header);
            });
            
            // Add empty cells before first day
            for (let i = 0; i < firstDay.getDay(); i++) {
                const emptyCell = document.createElement('div');
                calendar.appendChild(emptyCell);
            }
            
            // Add days of the month
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const date = new Date(year, month, day);
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                
                // Add price tag for available dates
                if (!isPastDate(date) && !isBeyondBookingWindow(date) && !isDateBooked(date)) {
                    const priceTag = document.createElement('div');
                    priceTag.className = 'price-tag';
                    priceTag.textContent = `$${NIGHTLY_RATE}`;
                    dayElement.appendChild(priceTag);
                }
                
                // Set state classes
                if (isPastDate(date) || isBeyondBookingWindow(date)) {
                    dayElement.classList.add('disabled');
                } else if (isDateBooked(date)) {
                    dayElement.classList.add('booked');
                } else {
                    dayElement.classList.add('available');
                    dayElement.addEventListener('click', () => selectDate(date));
                }
                
                // Mark selected dates
                if (selectedCheckin && formatDate(date) === formatDate(selectedCheckin)) {
                    dayElement.classList.add('selected');
                }
                if (selectedCheckout && formatDate(date) === formatDate(selectedCheckout)) {
                    dayElement.classList.add('selected');
                }
                
                calendar.appendChild(dayElement);
            }
            
            // Update navigation buttons
            const prevButton = document.getElementById('prevMonth');
            const nextButton = document.getElementById('nextMonth');
            
            // Disable previous button if showing current month
            const currentMonthStart = new Date(today.getFullYear(), today.getMonth(), 1);
            prevButton.disabled = currentDate <= currentMonthStart;
        }
        
        // Select date
        function selectDate(date) {
            if (!selectedCheckin || (selectedCheckin && selectedCheckout)) {
                // Start new selection
                selectedCheckin = date;
                selectedCheckout = null;
            } else {
                // Complete selection
                if (date > selectedCheckin) {
                    selectedCheckout = date;
                } else {
                    selectedCheckout = selectedCheckin;
                    selectedCheckin = date;
                }
            }
            
            updateSelectedDates();
            renderCalendar();
        }
        
        // Update selected dates display
        function updateSelectedDates() {
            const checkinInput = document.getElementById('checkin');
            const checkoutInput = document.getElementById('checkout');
            const pricingSummary = document.getElementById('pricingSummary');
            const bookButton = document.getElementById('bookButton');
            
            if (selectedCheckin) {
                checkinInput.value = selectedCheckin.toLocaleDateString('en-US', { 
                    weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' 
                });
            }
            
            if (selectedCheckout) {
                checkoutInput.value = selectedCheckout.toLocaleDateString('en-US', { 
                    weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' 
                });
                
                // Calculate pricing
                const nights = Math.ceil((selectedCheckout - selectedCheckin) / (1000 * 60 * 60 * 24));
                const totalPrice = nights * NIGHTLY_RATE;
                
                document.getElementById('totalNights').textContent = nights;
                document.getElementById('totalPrice').textContent = `$${totalPrice}`;
                pricingSummary.style.display = 'block';
                
                bookButton.disabled = false;
                bookButton.textContent = `Book Now - $${totalPrice}`;
            } else {
                checkoutInput.value = '';
                pricingSummary.style.display = 'none';
                bookButton.disabled = true;
                bookButton.textContent = 'Select check-out date';
            }
            
            if (!selectedCheckin) {
                checkinInput.value = '';
            }
        }
        
        // Navigation
        document.getElementById('prevMonth').addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        });
        
        document.getElementById('nextMonth').addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        });
        
        // Book button
        document.getElementById('bookButton').addEventListener('click', () => {
            if (selectedCheckin && selectedCheckout) {
                alert(`Booking request submitted!\n\nCheck-in: ${checkin.value}\nCheck-out: ${checkout.value}\nTotal: ${document.getElementById('totalPrice').textContent}\n\nYou would integrate this with your payment/booking system.`);
            }
        });
        
        // Initialize
        window.addEventListener('DOMContentLoaded', () => {
            loadBookingData();
        });
    </script>
</body>
</html>
