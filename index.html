<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luxury Coastal Retreat | Your Perfect Getaway</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
        }

        .hero {
            height: 100vh;
            background: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('https://images.unsplash.com/photo-1566073771259-6a8506099945?w=1600') center/cover;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: white;
            position: relative;
        }

        .hero-content {
            max-width: 800px;
            padding: 20px;
            animation: fadeIn 1s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .hero p {
            font-size: 1.5rem;
            margin-bottom: 30px;
        }

        .btn {
            display: inline-block;
            padding: 15px 40px;
            background: #ff6b6b;
            color: white;
            text-decoration: none;
            border-radius: 50px;
            font-size: 1.1rem;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
        }

        .btn:hover {
            background: #ff5252;
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(255,107,107,0.3);
        }

        .nav {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(255,255,255,0.95);
            padding: 20px 50px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ff6b6b;
        }

        .nav-links {
            display: flex;
            gap: 30px;
            list-style: none;
        }

        .nav-links a {
            color: #333;
            text-decoration: none;
            transition: color 0.3s;
            font-weight: 500;
        }

        .nav-links a:hover {
            color: #ff6b6b;
        }

        section {
            padding: 80px 50px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h2 {
            font-size: 2.5rem;
            margin-bottom: 40px;
            text-align: center;
            color: #333;
        }

        .highlight {
            color: #ff6b6b;
        }

        .property-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .detail-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s;
        }

        .detail-card:hover {
            transform: translateY(-10px);
        }

        .detail-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .detail-card h3 {
            margin-bottom: 10px;
            color: #ff6b6b;
        }

        .gallery {
            background: #f8f9fa;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }

        .gallery-item {
            height: 250px;
            border-radius: 15px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .gallery-item:hover {
            transform: scale(1.05);
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .amenities {
            background: white;
        }

        .amenities-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .amenity-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            transition: all 0.3s;
        }

        .amenity-item:hover {
            background: #ff6b6b;
            color: white;
        }

        .amenity-icon {
            font-size: 2rem;
        }

        .reviews {
            background: #f8f9fa;
        }

        .review-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .review-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .stars {
            color: #ffd700;
            font-size: 1.2rem;
            margin-bottom: 15px;
        }

        .reviewer {
            margin-top: 20px;
            font-weight: bold;
            color: #ff6b6b;
        }

        .location {
            background: white;
        }

        .location-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-top: 40px;
            align-items: start;
        }

        .location-text h3 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #333;
        }

        .location-text p {
            font-size: 1.1rem;
            line-height: 1.8;
            margin-bottom: 30px;
        }

        .nearby-attractions h4 {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: #ff6b6b;
        }

        .nearby-attractions ul {
            list-style: none;
        }

        .nearby-attractions li {
            padding: 10px 0;
            font-size: 1.1rem;
            border-bottom: 1px solid #f0f0f0;
        }

        .map-container {
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        @media (max-width: 968px) {
            .location-info {
                grid-template-columns: 1fr;
            }
        }

        .contact {
            background: white;
        }

        .booking-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-top: 40px;
        }

        .calendar-section, .booking-form-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
        }

        .calendar-section h3, .booking-form-section h3 {
            margin-bottom: 20px;
            color: #333;
        }

        #calendar-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-nav-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .calendar-nav-btn:hover {
            background: #ff5252;
        }

        #calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 20px;
        }

        .calendar-day-header {
            text-align: center;
            font-weight: bold;
            padding: 10px;
            background: #333;
            color: white;
            border-radius: 5px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
        }

        .calendar-day:hover:not(.disabled):not(.booked):not(.out-of-range) {
            transform: scale(1.05);
            border-color: #ff6b6b;
        }

        .calendar-day.disabled {
            background: #f0f0f0;
            color: #999;
            cursor: not-allowed;
        }

        .calendar-day.booked {
            background: #ffebee;
            color: #999;
            cursor: not-allowed;
            text-decoration: line-through;
        }

        .calendar-day.out-of-range {
            background: #f0f0f0;
            color: #999;
            cursor: not-allowed;
        }

        .calendar-day.selected {
            background: #ff6b6b;
            color: white;
            border-color: #ff6b6b;
        }

        .calendar-day.in-range {
            background: #ffe0e0;
            border-color: #ff6b6b;
        }

        .day-number {
            font-size: 1.2rem;
            font-weight: bold;
        }

        .day-price {
            font-size: 0.8rem;
            color: #666;
        }

        .calendar-day.selected .day-price {
            color: white;
        }

        .calendar-legend {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 15px;
            font-size: 0.9rem;
            flex-wrap: wrap;
        }

        .legend-box {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 4px;
            margin-right: 5px;
            vertical-align: middle;
        }

        .legend-box.available {
            background: white;
            border: 2px solid #ddd;
        }

        .legend-box.booked {
            background: #ffebee;
            border: 2px solid #ddd;
        }

        .legend-box.selected {
            background: #ff6b6b;
        }

        .legend-box.out-of-range {
            background: #f0f0f0;
            border: 2px solid #ddd;
        }

        #booking-summary {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border: 2px solid #ff6b6b;
        }

        #booking-summary h4 {
            margin-bottom: 15px;
            color: #ff6b6b;
        }

        #booking-summary p {
            margin: 10px 0;
        }

        .price-row {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .price-row.total {
            border-bottom: 2px solid #ff6b6b;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .discount-badge {
            display: inline-block;
            background: #4caf50;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.85rem;
            margin-left: 10px;
        }

        #total-price {
            color: #ff6b6b;
            font-weight: bold;
        }

        .contact-form {
            max-width: 600px;
            margin: 40px auto;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #ff6b6b;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 150px;
        }

        footer {
            background: #333;
            color: white;
            text-align: center;
            padding: 30px;
        }

        .booking-bar {
            background: #ff6b6b;
            color: white;
            padding: 20px;
            text-align: center;
            position: sticky;
            top: 80px;
            z-index: 999;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .booking-bar p {
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        .price {
            font-size: 2rem;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2rem;
            }
            
            .hero p {
                font-size: 1.1rem;
            }

            .nav {
                padding: 15px 20px;
            }

            .nav-links {
                gap: 15px;
                font-size: 0.9rem;
            }

            section {
                padding: 60px 20px;
            }

            h2 {
                font-size: 2rem;
            }

            .booking-container {
                grid-template-columns: 1fr;
            }

            .calendar-legend {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <nav class="nav">
        <div class="logo">üèñÔ∏è Coastal Retreat</div>
        <ul class="nav-links">
            <li><a href="#details">Details</a></li>
            <li><a href="#gallery">Gallery</a></li>
            <li><a href="#amenities">Amenities</a></li>
            <li><a href="#reviews">Reviews</a></li>
            <li><a href="#location">Location</a></li>
            <li><a href="#contact">Book Now</a></li>
        </ul>
    </nav>

    <div class="hero">
        <div class="hero-content">
            <h1>Your Luxury Coastal Escape</h1>
            <p>Experience paradise in our stunning beachfront property</p>
            <a href="#contact" class="btn">Book Your Stay</a>
        </div>
    </div>

    <div class="booking-bar">
        <p><span class="price">$299</span> per night</p>
        <a href="#contact" class="btn" style="background: white; color: #ff6b6b;">Check Availability</a>
    </div>

    <section id="details">
        <div class="container">
            <h2>Property <span class="highlight">Details</span></h2>
            <div class="property-details">
                <div class="detail-card">
                    <div class="detail-icon">üõèÔ∏è</div>
                    <h3>3 Bedrooms</h3>
                    <p>Spacious rooms with premium bedding and stunning views</p>
                </div>
                <div class="detail-card">
                    <div class="detail-icon">üöø</div>
                    <h3>2.5 Bathrooms</h3>
                    <p>Modern fixtures and luxury amenities throughout</p>
                </div>
                <div class="detail-card">
                    <div class="detail-icon">üë•</div>
                    <h3>Sleeps 8</h3>
                    <p>Perfect for families or groups of friends</p>
                </div>
                <div class="detail-card">
                    <div class="detail-icon">üìè</div>
                    <h3>2,400 sq ft</h3>
                    <p>Plenty of space to relax and unwind</p>
                </div>
            </div>
        </div>
    </section>

    <section id="gallery" class="gallery">
        <div class="container">
            <h2>Photo <span class="highlight">Gallery</span></h2>
            <div class="gallery-grid">
                <div class="gallery-item">
                    <img src="https://images.unsplash.com/photo-1502672260266-1c1ef2d93688?w=600" alt="Living Room">
                </div>
                <div class="gallery-item">
                    <img src="https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=600" alt="Bedroom">
                </div>
                <div class="gallery-item">
                    <img src="https://images.unsplash.com/photo-1556912173-46c336c7fd55?w=600" alt="Kitchen">
                </div>
                <div class="gallery-item">
                    <img src="https://images.unsplash.com/photo-1564013799919-ab600027ffc6?w=600" alt="Bathroom">
                </div>
                <div class="gallery-item">
                    <img src="https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=600" alt="Patio">
                </div>
                <div class="gallery-item">
                    <img src="https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=600" alt="Beach View">
                </div>
            </div>
        </div>
    </section>

    <section id="amenities" class="amenities">
        <div class="container">
            <h2>Premium <span class="highlight">Amenities</span></h2>
            <div class="amenities-grid">
                <div class="amenity-item">
                    <span class="amenity-icon">üì∂</span>
                    <span>High-Speed WiFi</span>
                </div>
                <div class="amenity-item">
                    <span class="amenity-icon">üèä</span>
                    <span>Private Pool</span>
                </div>
                <div class="amenity-item">
                    <span class="amenity-icon">üÖøÔ∏è</span>
                    <span>Free Parking</span>
                </div>
                <div class="amenity-item">
                    <span class="amenity-icon">‚ùÑÔ∏è</span>
                    <span>Air Conditioning</span>
                </div>
                <div class="amenity-item">
                    <span class="amenity-icon">üç≥</span>
                    <span>Full Kitchen</span>
                </div>
                <div class="amenity-item">
                    <span class="amenity-icon">üì∫</span>
                    <span>Smart TV</span>
                </div>
                <div class="amenity-item">
                    <span class="amenity-icon">üß∫</span>
                    <span>Washer & Dryer</span>
                </div>
                <div class="amenity-item">
                    <span class="amenity-icon">üå¥</span>
                    <span>Beach Access</span>
                </div>
                <div class="amenity-item">
                    <span class="amenity-icon">üî•</span>
                    <span>Fire Pit</span>
                </div>
                <div class="amenity-item">
                    <span class="amenity-icon">üçñ</span>
                    <span>BBQ Grill</span>
                </div>
                <div class="amenity-item">
                    <span class="amenity-icon">üêï</span>
                    <span>Pet Friendly</span>
                </div>
                <div class="amenity-item">
                    <span class="amenity-icon">üéÆ</span>
                    <span>Game Room</span>
                </div>
            </div>
        </div>
    </section>

    <section id="reviews" class="reviews">
        <div class="container">
            <h2>Guest <span class="highlight">Reviews</span></h2>
            <div class="review-grid">
                <div class="review-card">
                    <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                    <p>"Absolutely stunning property! The views were breathtaking and the home had everything we needed. We can't wait to come back!"</p>
                    <p class="reviewer">- Sarah M.</p>
                </div>
                <div class="review-card">
                    <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                    <p>"Perfect getaway for our family. The kids loved the pool and we enjoyed relaxing on the deck. Host was very responsive and helpful."</p>
                    <p class="reviewer">- Michael T.</p>
                </div>
                <div class="review-card">
                    <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                    <p>"This place exceeded all expectations! Clean, spacious, and the location is unbeatable. Already booked our next stay!"</p>
                    <p class="reviewer">- Jennifer L.</p>
                </div>
            </div>
        </div>
    </section>

    <section id="location" class="location">
        <div class="container">
            <h2>Perfect <span class="highlight">Location</span></h2>
            <div class="location-info">
                <div class="location-text">
                    <h3>üìç Malibu Area, California</h3>
                    <p>Our property is located in the beautiful coastal area of Malibu (ZIP: 902XX). Enjoy pristine beaches, world-class dining, and stunning natural beauty.</p>
                    <div class="nearby-attractions">
                        <h4>Nearby Attractions:</h4>
                        <ul>
                            <li>üèñÔ∏è Beach Access - 2 min walk</li>
                            <li>üçΩÔ∏è Restaurants & Cafes - 5 min drive</li>
                            <li>üõí Grocery Store - 8 min drive</li>
                            <li>üé£ Malibu Pier - 10 min drive</li>
                            <li>ü•æ Hiking Trails - 15 min drive</li>
                            <li>‚úàÔ∏è LAX Airport - 45 min drive</li>
                        </ul>
                    </div>
                </div>
                <div class="map-container">
                    <iframe 
                        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d106118.60831419257!2d-118.87562383476562!3d34.03508590000001!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x80e81da9f908d63f%3A0x93b72d71b2ea8c5a!2sMalibu%2C%20CA!5e0!3m2!1sen!2sus!4v1234567890123!5m2!1sen!2sus"
                        width="100%" 
                        height="450" 
                        style="border:0; border-radius: 15px;" 
                        allowfullscreen="" 
                        loading="lazy" 
                        referrerpolicy="no-referrer-when-downgrade">
                    </iframe>
                </div>
            </div>
        </div>
    </section>

    <section id="contact" class="contact">
        <div class="container">
            <h2>Check Availability & <span class="highlight">Book</span></h2>
            
            <div class="booking-container">
                <div class="calendar-section">
                    <h3>Select Your Dates</h3>
                    <p style="font-size: 0.9rem; color: #666; margin-bottom: 15px;">üìÖ Bookings available up to 3 months from today</p>
                    <div id="calendar-controls">
                        <button id="prev-btn" class="calendar-nav-btn">‚Üê Previous</button>
                        <h4 id="calendar-month"></h4>
                        <button id="next-btn" class="calendar-nav-btn">Next ‚Üí</button>
                    </div>
                    <div id="calendar"></div>
                    <div class="calendar-legend">
                        <div><span class="legend-box available"></span> Available</div>
                        <div><span class="legend-box booked"></span> Booked</div>
                        <div><span class="legend-box selected"></span> Selected</div>
                        <div><span class="legend-box out-of-range"></span> Beyond 3 months</div>
                    </div>
                    <div id="booking-summary" style="display: none;">
                        <h4>Booking Summary</h4>
                        <p><strong>Check-in:</strong> <span id="checkin-date"></span></p>
                        <p><strong>Check-out:</strong> <span id="checkout-date"></span></p>
                        <p><strong>Nights:</strong> <span id="num-nights"></span></p>
                        <div class="price-row">
                            <span>Subtotal ($<span id="nightly-rate">299</span>/night):</span>
                            <span id="subtotal-price">$0</span>
                        </div>
                        <div id="discount-row" class="price-row" style="display: none;">
                            <span>Discount (<span id="discount-percent">0</span>%):</span>
                            <span id="discount-amount" style="color: #4caf50;">-$0</span>
                        </div>
                        <div class="price-row total">
                            <span>Total Price:</span>
                            <span id="total-price">$0</span>
                        </div>
                    </div>
                </div>

                <div class="booking-form-section">
                    <h3>Request Your Booking</h3>
                    <form class="contact-form" onsubmit="handleSubmit(event)">
                        <div class="form-group">
                            <label>Name</label>
                            <input type="text" id="guest-name" required placeholder="Your full name">
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="guest-email" required placeholder="your@email.com">
                        </div>
                        <div class="form-group">
                            <label>Phone</label>
                            <input type="tel" id="guest-phone" required placeholder="(555) 123-4567">
                        </div>
                        <div class="form-group">
                            <label>Number of Guests</label>
                            <input type="number" id="num-guests" min="1" max="8" required placeholder="1-8 guests">
                        </div>
                        <div class="form-group">
                            <label>Special Requests</label>
                            <textarea id="special-requests" placeholder="Any special requests or questions?"></textarea>
                        </div>
                        <button type="submit" class="btn" style="width: 100%;">Request Booking</button>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <footer>
        <p>&copy; 2024 Coastal Retreat. All rights reserved.</p>
        <p>üìß info@coastalretreat.com | üìû (555) 123-4567</p>
    </footer>

    <script>
        console.log('Script version 3.1 loaded - with discounts and 3-month limit');
        
        const GOOGLE_SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQrRbWKrKBZ9HZThn3O0ns8DvJinCBtL7ICXglk5FvvAWcQv1xVf551hrq2UVC_4cB7Ifq9pn2E9XsQ/pub?gid=0&single=true&output=csv';
        const BOOKING_LIMIT_DAYS = 90;
        
        let availabilityData = {};
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        let selectedCheckIn = null;
        let selectedCheckOut = null;

        // ===========================================
        // LOAD DATA FROM GOOGLE SHEETS
        // ===========================================
        async function loadAvailabilityData() {
            console.log('‚úÖ loadAvailabilityData() called');
            loadSampleData();
        }

        function parseCSVData(csvText) {
            availabilityData = {};
            const lines = csvText.split('\n');
            
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;
                
                const parts = line.split(',');
                const dateStr = parts[0] ? parts[0].trim() : '';
                const available = parts[1] ? parts[1].trim() : '';
                const price = parts[2] ? parts[2].trim() : '';
                
                if (dateStr) {
                    availabilityData[dateStr] = {
                        available: available.toLowerCase() === 'yes',
                        price: parseFloat(price) || 299
                    };
                }
            }
            console.log('‚úÖ Loaded ' + Object.keys(availabilityData).length + ' dates from Google Sheet');
        }

        function loadSampleData() {
            availabilityData = {};
            console.log('Using sample data');
            renderCalendar();
        }

        // ===========================================
        // CALCULATE DISCOUNT
        // ===========================================
        function calculateDiscount(nights) {
            if (nights > 30) {
                return 0.15; // 15% discount for more than 1 month
            } else if (nights > 7) {
                return 0.08; // 8% discount for more than 7 days
            }
            return 0; // No discount
        }

        // ===========================================
        // CALENDAR RENDERING
        // ===========================================
        function renderCalendar() {
            const calendar = document.getElementById('calendar');
            const monthHeader = document.getElementById('calendar-month');
            
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                              'July', 'August', 'September', 'October', 'November', 'December'];
            
            monthHeader.textContent = `${monthNames[currentMonth]} ${currentYear}`;
            
            calendar.innerHTML = '';
            
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            days.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-day-header';
                header.textContent = day;
                calendar.appendChild(header);
            });
            
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            
            for (let i = 0; i < firstDay; i++) {
                const emptyCell = document.createElement('div');
                calendar.appendChild(emptyCell);
            }
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // Calculate the cutoff date (90 days from today)
            const cutoffDate = new Date(today);
            cutoffDate.setDate(cutoffDate.getDate() + BOOKING_LIMIT_DAYS);
            
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(currentYear, currentMonth, day);
                const dateStr = formatDate(date);
                const dayData = availabilityData[dateStr] || { available: true, price: 299 };
                
                const dayCell = document.createElement('div');
                dayCell.className = 'calendar-day';
                
                // Check if date is in the past
                if (date < today) {
                    dayCell.classList.add('disabled');
                } 
                // Check if date is beyond 3 months
                else if (date > cutoffDate) {
                    dayCell.classList.add('out-of-range');
                } 
                // Check if date is booked
                else if (!dayData.available) {
                    dayCell.classList.add('booked');
                }
                
                // Check if date is selected
                if (selectedCheckIn && dateStr === formatDate(selectedCheckIn)) {
                    dayCell.classList.add('selected');
                }
                if (selectedCheckOut && dateStr === formatDate(selectedCheckOut)) {
                    dayCell.classList.add('selected');
                }
                
                // Check if date is in range
                if (selectedCheckIn && selectedCheckOut) {
                    if (date > selectedCheckIn && date < selectedCheckOut) {
                        dayCell.classList.add('in-range');
                    }
                }
                
                const dayNumber = document.createElement('div');
                dayNumber.className = 'day-number';
                dayNumber.textContent = day;
                
                const dayPrice = document.createElement('div');
                dayPrice.className = 'day-price';
                dayPrice.textContent = dayData.available ? `${dayData.price}` : 'Booked';
                
                dayCell.appendChild(dayNumber);
                dayCell.appendChild(dayPrice);
                
                // Only allow clicking if date is available, not in past, and within 3 months
                if (date >= today && date <= cutoffDate && dayData.available) {
                    dayCell.onclick = () => selectDate(date);
                }
                
                calendar.appendChild(dayCell);
            }
        }

        function selectDate(date) {
            if (!selectedCheckIn || (selectedCheckIn && selectedCheckOut)) {
                selectedCheckIn = date;
                selectedCheckOut = null;
            } else if (date > selectedCheckIn) {
                selectedCheckOut = date;
                updateBookingSummary();
            } else {
                selectedCheckIn = date;
                selectedCheckOut = null;
            }
            
            renderCalendar();
        }

        function updateBookingSummary() {
            const summary = document.getElementById('booking-summary');
            
            if (selectedCheckIn && selectedCheckOut) {
                summary.style.display = 'block';
                
                document.getElementById('checkin-date').textContent = selectedCheckIn.toLocaleDateString();
                document.getElementById('checkout-date').textContent = selectedCheckOut.toLocaleDateString();
                
                const nights = Math.ceil((selectedCheckOut - selectedCheckIn) / (1000 * 60 * 60 * 24));
                let subtotal = 0;
                
                for (let i = 0; i < nights; i++) {
                    const date = new Date(selectedCheckIn);
                    date.setDate(date.getDate() + i);
                    const dateStr = formatDate(date);
                    const dayData = availabilityData[dateStr];
                    
                    if (dayData && dayData.price) {
                        subtotal += dayData.price;
                    } else {
                        subtotal += 299;
                    }
                }
                
                // Calculate discount
                const discountRate = calculateDiscount(nights);
                const discountAmount = subtotal * discountRate;
                const totalPrice = subtotal - discountAmount;
                
                document.getElementById('num-nights').textContent = nights;
                document.getElementById('subtotal-price').textContent = `${subtotal.toLocaleString()}`;
                document.getElementById('total-price').textContent = `${totalPrice.toLocaleString()}`;
                
                const discountRow = document.getElementById('discount-row');
                if (discountRate > 0) {
                    discountRow.style.display = 'flex';
                    document.getElementById('discount-percent').textContent = Math.round(discountRate * 100);
                    document.getElementById('discount-amount').textContent = `-${discountAmount.toLocaleString()}`;
                } else {
                    discountRow.style.display = 'none';
                }
            } else {
                summary.style.display = 'none';
            }
        }

        function previousMonth() {
            if (currentMonth === 0) {
                currentMonth = 11;
                currentYear--;
            } else {
                currentMonth--;
            }
            renderCalendar();
        }

        function nextMonth() {
            if (currentMonth === 11) {
                currentMonth = 0;
                currentYear++;
            } else {
                currentMonth++;
            }
            renderCalendar();
        }

        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // ===========================================
        // FORM SUBMISSION
        // ===========================================
        function handleSubmit(e) {
            e.preventDefault();
            
            if (!selectedCheckIn || !selectedCheckOut) {
                alert('Please select check-in and check-out dates from the calendar.');
                return;
            }
            
            const nights = Math.ceil((selectedCheckOut - selectedCheckIn) / (1000 * 60 * 60 * 24));
            const discountRate = calculateDiscount(nights);
            const discountPercent = Math.round(discountRate * 100);
            
            const formData = {
                name: document.getElementById('guest-name').value,
                email: document.getElementById('guest-email').value,
                phone: document.getElementById('guest-phone').value,
                guests: document.getElementById('num-guests').value,
                checkIn: selectedCheckIn.toLocaleDateString(),
                checkOut: selectedCheckOut.toLocaleDateString(),
                nights: nights,
                discount: discountPercent > 0 ? `${discountPercent}%` : 'None',
                totalPrice: document.getElementById('total-price').textContent,
                specialRequests: document.getElementById('special-requests').value
            };
            
            console.log('Booking request:', formData);
            
            let discountMessage = '';
            if (discountPercent > 0) {
                discountMessage = ` You received a ${discountPercent}% discount!`;
            }
            
            alert(`Thank you ${formData.name}! Your booking request for ${formData.checkIn} to ${formData.checkOut} (${nights} nights) has been received.${discountMessage}\n\nTotal: ${formData.totalPrice}\n\nWe will contact you shortly to confirm your reservation.`);
            
            e.target.reset();
            selectedCheckIn = null;
            selectedCheckOut = null;
            renderCalendar();
            document.getElementById('booking-summary').style.display = 'none';
        }

        // ===========================================
        // SMOOTH SCROLLING
        // ===========================================
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        });

        window.addEventListener('scroll', () => {
            const nav = document.querySelector('.nav');
            if (window.scrollY > 100) {
                nav.style.background = 'rgba(255,255,255,0.98)';
            } else {
                nav.style.background = 'rgba(255,255,255,0.95)';
            }
        });

        // ===========================================
        // INITIALIZE ON PAGE LOAD
        // ===========================================
        window.addEventListener('load', () => {
            console.log('Page loaded, initializing calendar...');
            loadAvailabilityData();
        });
        
        // Also initialize immediately in case load event already fired
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadAvailabilityData);
        } else {
            loadAvailabilityData();
        }
